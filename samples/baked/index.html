<!doctype html>
<html lang="en-us">
  <head>
    <title>ozz-animation sample</title>
    <style>
      canvas {
        width: 96vw;
        height: 54vw;  // 16/9 aspect ratio
      }
    </style>
    <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="w3-container w3-center">
      <div class="w3-row">
        <div class="w3-half">
          <img src="https://raw.githubusercontent.com/guillaumeblanc/ozz-animation/master/media/icon/ozz-grey-256.png" width="196" height="196">
        </div>
        <div class="w3-half">
          <h1>ozz-animation</h1>
          <p>Open source c++ skeletal animation engine and tools</p>
          <a class="w3-btn w3-white w3-border w3-border-blue w3-round" href="https://github.com/guillaumeblanc/ozz-animation">View on GitHub<img src="https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png" width="24" height="24"></a>
          <a class="w3-btn w3-white w3-border w3-border-blue w3-round" href="https://twitter.com/jozz_sc">Follow @jozz_sc <img src="https://upload.wikimedia.org/wikipedia/en/9/9f/Twitter_bird_logo_2012.svg" width="24" height="24"></a>
        </div>
      </div>
      <div id="sample_border" class="w3-border-0">
        <p id="sample_status">Initializing WebGL</p>
        <div><canvas id="sample_canvas" class="w3-round w3-black" oncontextmenu="event.preventDefault()"></canvas></div>
        <textarea id="sample_output" class="w3-light-grey w3-round" rows="8" style="width:100%;"></textarea>
      </div>
    </div>
    <script>
      var sample_border = document.getElementById("sample_border");
      var sample_canvas = document.getElementById("sample_canvas");
      var sample_status = document.getElementById("sample_status");
      var sample_output = document.getElementById("sample_output");

      document.getElementsByTagName("body")[0].onresize = CanvasResize;

      function CanvasResize() {
        sample_canvas.width = sample_canvas.clientWidth;
        sample_canvas.height = sample_canvas.clientWidth * 9 / 16;
      }

      function CheckWebGLSupport(canvas) {
        if (!window.WebGLRenderingContext) {
          // The browser doesn't even know what WebGL is.
          return [false, 'Your browser doesn\'t support WebGL. Visit <a href="http://get.webgl.org" target="_blank">http://get.webgl.org</a> for more information.'];
        } else {
          //  If the browser supports WebGL and canvas.getContext("webgl") returns null then WebGL failed for some reason other than user's browser (no GPU, out of memory, etc...)
          var gl_context = canvas.getContext("webgl");
          if (!gl_context) {
            gl_context = canvas.getContext("experimental-webgl");      
          }
          if (!gl_context) {
            return [false, 'Your browser supports WebGL but could not properly initialize it. Visit <a href="http://get.webgl.org/troubleshooting" target="_blank">http://get.webgl.org/troubleshooting</a> for more information.'];
          }
        }
        // Success.
        return [true, 'WebGL is supported by your browser.'];
      }

      function OnSampleSuccess() {
        sample_status.innerHTML = "ozz-animation sample compiled from c++ with emscripten.";
        // Initialize canvas size
        CanvasResize();
      }

      function OnSampleFailure(text) {
        //sample_border.style.display = "none";  // Disable the whole sample display.
        sample_status.innerHTML = text;
      }

      function OnSampleProgress(text) {
        sample_status.innerHTML = text;
      }
      
      var webgl_support = CheckWebGLSupport(sample_canvas);

      if(!webgl_support[0]) {
        OnSampleFailure(webgl_support[1]);
      } else {
        var Module = {
          arguments: ['--resolution=7'],
          preRun: [],
          postRun: [],
          print: (function() {
            if (sample_output) sample_output.value = ''; // Clears browser cache
            return function(text) {
              text = Array.prototype.slice.call(arguments).join(' ');
              console.log(text);
              if (sample_output) {
                sample_output.value += text + "\n";
                sample_output.scrollTop = sample_output.scrollHeight; // Focus on bottom
              }
            };
          })(),
          printErr: function(text) {
            text = Array.prototype.slice.call(arguments).join(' ');
            console.error(text);
          },
          canvas: sample_canvas,
          setStatus: function(text) {
            if(text == '') {
              // This signals sample initialization success.
              OnSampleSuccess();
            } else {
              OnSampleProgress(text);
            }
          }
        };
        Module.setStatus('Downloading...');
      }
    </script>
    <script async type="text/javascript" src="sample_baked.js"></script>
  </body>
</html>

